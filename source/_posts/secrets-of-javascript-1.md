title: javascript作用域--减少全局变量污染
date: 2013-12-10 21:19:18
categories: [web开发]
tags: [javascript]
---

全局变量定义
----------------------

* 在任何函数外面定义var语句

```sh
var a = 'value';
```

* 直接添加属性在全局对象上

```sh
window.a = 'value';    //全局对象是所有全局变量的容器
```
<!--more-->
* 直接使用未经声明的变量

```sh
a = 'value';
```

全局变量的优缺点
-------------------

###全局变量带来的问题

* 污染全局命名空间，并可能导致命名冲突。
* 全局变量不利于模块化，它会导致程序独立组件间不必要的耦合。
* 使程序难以调试，任何依赖全局变量才能正常工作的函数，只有为其创建完整全局环境才能正确调试它。

###全局变量带来的好处

* 虽说全局变量会引来很多问题，但全局命名空间是javascript组件进行交互的唯一途径，组件或者程序库不得不定义一些全局变量，以便程序其他部分使用。如：jQuery库，就定义了两个全局变量$和jQuery
* 使用全局对象来做特性检测也是不可或缺的用途。

全局变量的解决方案
-------------------

* 避免声明全局变量，尽可能在函数体顶部声明局部变量。
* 避免意外的全局变量（使用JSLint或JSHint工具来检测，或者在严格模式`"user strict"`下写javascript代码，这些方法会执行比较严格的检测）。
* 使用全局对象做特性检测。
* 单全局变量方式。
* 使用闭包也是一种有效减少全局污染的方法。

###单全局变量方式

顾名思义，只创建唯一一个全局对象，将所有的功能代码都挂靠在这个全局对象上。
```sh
var myBook = {};
myBook.name = '高性能javascript';
myBook.chapter = 10;

```

###闭包

减缓全局变量污染全局空间：利用函数的作用域

```sh
// 采用闭包，让代码模块化，以减少全局变量的污染
var test = (function(){
    var a = 1;
    function innerOne(){
        a++;
        console.log(a);
    }
    function innerTwo(){
        a++;
        console.log(a);
    }
    return {
        a : innerOne,
        b : innerTwo
    }
})();

//调用
test.a();   //2
test.b();   //3
```




